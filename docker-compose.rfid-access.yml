services:
  rfid_access:
    build:
      context: ./rfid-access-service
    env_file:
      - ./rfid-access-service/.env
    environment:
      - MQTT_HOST=${MQTT_HOST:-localhost}
      - MQTT_PORT=${MQTT_PORT:-1883}
      - MQTT_USER=${MQTT_USER:-Horizon@user2024}
      - MQTT_PASS=${MQTT_PASS:-Chanel_horizon@2024}
      - HTTP_PORT=${HTTP_PORT:-3001}
      - BASE_PATH=${BASE_PATH:-/elecnor}
      - RFID_WEB_ENABLED=${RFID_WEB_ENABLED:-1}
      - RFID_WEB_SESSION_SECRET=${RFID_WEB_SESSION_SECRET:-rfid-access-secret}
      - RFID_WEB_USERNAME=${RFID_WEB_USERNAME:-admin}
      - RFID_WEB_PASSWORD=${RFID_WEB_PASSWORD:-admin}
      - RFID_WEB_HISTORY_SIZE=${RFID_WEB_HISTORY_SIZE:-25}
      - RFID_DB_HOST=${RFID_DB_HOST:-postgres}
      - RFID_DB_PORT=${RFID_DB_PORT:-5432}
      - RFID_DB_USER=${RFID_DB_USER:-horizonst}
      - RFID_DB_PASSWORD=${RFID_DB_PASSWORD:-horizonst}
      - RFID_DB_NAME=${RFID_DB_NAME:-rfid_access}
      - RFID_DB_ADMIN_DB=${RFID_DB_ADMIN_DB:-postgres}
      - RFID_DB_SSL=${RFID_DB_SSL:-0}
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: "50m"
        max-file: "3"
    ports:
      - "127.0.0.1:${HTTP_PORT:-3001}:${HTTP_PORT:-3001}"
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://127.0.0.1:${HTTP_PORT:-3001}/health"]
      interval: 20s
      timeout: 3s
      retries: 5
    networks:
      - rfid_access_net

networks:
  rfid_access_net:
    driver: bridge
