<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Elecnor · GPIO lector</title>
    <base href="__BASE_PATH__/" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="__BASE_PATH__/style.css" />
  </head>
  <body class="elecnor-shell">
    <header class="topbar">
      <div class="brand">
        <div class="brand__mark" aria-hidden="true">elecnor</div>
        <div class="brand__text">
          <strong>Portal de accesos</strong>
          <span>Pruebas GPIO</span>
        </div>
      </div>
      <div class="topbar__cluster">
        <nav class="topbar__nav" aria-label="Navegación principal">
          <a class="nav-link" href="__BASE_PATH__/elecnor-tarjetas.html" data-router data-nav-view="tarjetas"
            >Tarjetas</a
          >
          <a
            class="nav-link"
            href="__BASE_PATH__/elecnor-lecturas.html"
            data-requires-admin
            hidden
            aria-hidden="true"
            tabindex="-1"
            inert
            data-router
            data-nav-view="lecturas"
            >Lecturas</a
          >
          <a class="nav-link" href="__BASE_PATH__/elecnor-accesos.html" data-router data-nav-view="accesos">Accesos</a>
          <a class="nav-link" href="__BASE_PATH__/elecnor-seguimiento.html" data-router data-nav-view="seguimiento"
            >Seguimiento</a
          >
          <a class="nav-link" href="__BASE_PATH__/elecnor-usuarios.html" data-router data-nav-view="usuarios"
            >Trabajadores</a
          >
          <a
            class="nav-link"
            href="__BASE_PATH__/elecnor-cuentas.html"
            data-requires-admin
            hidden
            aria-hidden="true"
            tabindex="-1"
            inert
            data-router
            data-nav-view="cuentas"
            >Cuentas</a
          >
          <a
            class="nav-link nav-link--active"
            href="__BASE_PATH__/elecnor-gpo.html"
            aria-current="page"
            data-requires-admin
            data-router
            data-nav-view="gpo"
            >GPIO</a
          >
        </nav>
        <button type="button" class="cta cta--ghost topbar__logout" data-logout>Desconectar</button>
      </div>
    </header>

    <main id="main-view" class="page" data-view="gpo">
      <section class="hero hero--compact">
        <div>
          <p class="breadcrumb"><a href="__BASE_PATH__/elecnor-tarjetas.html">Inicio</a> · Elecnor · GPIO</p>
          <h1>Pruebas manuales de GPIO</h1>
          <p class="lead">
            Activa las líneas del lector de forma manual para validar cableado, relés y respuestas sin depender de los
            accesos automáticos.
          </p>
          <div class="pill-row">
            <span class="pill pill--accent">Solo administradores</span>
            <span class="pill pill--info">Pulso directo vía API setGPO</span>
            <span class="pill pill--neutral">Sincroniza con el hardware conectado</span>
          </div>
        </div>
        <div class="hero__cta">
          <div class="callout">
            <p class="eyebrow">Referencias</p>
            <p>"Acceso permitido" enciende GPO4 durante 5 segundos. "Acceso denegado" activa GPO5 10s y GPO6 5s.</p>
          </div>
        </div>
      </section>

      <section class="panel-grid">
        <article class="panel">
          <header class="panel__header">
            <div>
              <p class="eyebrow">Estado</p>
              <h2>Control GPIO del lector</h2>
              <p class="muted">Usamos la configuración actual para lanzar las peticiones setGPO.</p>
            </div>
            <span id="gpo-status" class="badge badge--muted">Comprobando...</span>
          </header>
          <p id="gpo-error" class="error" hidden></p>
          <dl class="definition-grid">
            <div>
              <dt>Endpoint base</dt>
              <dd id="gpo-base-url" class="muted">—</dd>
            </div>
            <div>
              <dt>Modo de ruta</dt>
              <dd id="gpo-path-mode" class="muted">—</dd>
            </div>
            <div>
              <dt>Device ID</dt>
              <dd id="gpo-device-id" class="muted">—</dd>
            </div>
            <div>
              <dt>Credenciales</dt>
              <dd id="gpo-auth-user" class="muted">Sin usuario</dd>
            </div>
            <div>
              <dt>Líneas disponibles</dt>
              <dd id="gpo-lines" class="muted">—</dd>
            </div>
          </dl>
          <form id="gpo-base-url-form" class="form-grid">
            <label class="form-field">
              <span>Probar con otra URL del lector</span>
              <input
                type="url"
                id="gpo-base-url-input"
                name="baseUrl"
                placeholder="http://88.20.2.60"
                inputmode="url"
                autocomplete="off"
              />
            </label>
            <div class="form-actions">
              <button type="submit" class="cta cta--ghost">Actualizar URL</button>
              <p class="muted">Cambiar esta URL solo afecta a las pruebas manuales.</p>
            </div>
          </form>
          <form id="gpo-path-mode-form" class="form-grid">
            <fieldset class="form-field">
              <legend>Ruta de control</legend>
              <div class="option-row">
                <label class="option">
                  <input type="radio" name="pathMode" id="gpo-path-multi" value="multi" checked />
                  <span>
                    <strong>Varios dispositivos (/devices/{id}/setGPO)</strong>
                    <small>Necesita el deviceId publicado por el lector.</small>
                  </span>
                </label>
                <label class="option">
                  <input type="radio" name="pathMode" id="gpo-path-single" value="single" />
                  <span>
                    <strong>Un único dispositivo (/device/setGPO)</strong>
                    <small>Ignora el deviceId y usa la ruta simplificada.</small>
                  </span>
                </label>
              </div>
            </fieldset>
            <div class="form-actions">
              <button type="submit" class="cta cta--ghost">Guardar modo</button>
              <p class="muted">Activa el modo que corresponda con tu firmware: múltiple o único dispositivo.</p>
            </div>
          </form>
          <form id="gpo-device-id-form" class="form-grid">
            <label class="form-field">
              <span>ID de dispositivo (deviceId)</span>
              <input
                type="text"
                id="gpo-device-id-input"
                name="deviceId"
                placeholder="000000000000"
                autocomplete="off"
              />
            </label>
            <div class="form-actions">
              <button type="submit" class="cta cta--ghost">Guardar deviceId</button>
              <p class="muted">Necesario para construir la ruta /devices/{id}/setGPO.</p>
            </div>
          </form>
          <form id="gpo-credentials-form" class="form-grid">
            <label class="form-field">
              <span>Tipo de autenticación</span>
              <select id="gpo-auth-type" name="authType">
                <option value="digest">Digest (MD5)</option>
                <option value="basic">Basic</option>
                <option value="none">Sin autenticación</option>
              </select>
            </label>
            <label class="form-field">
              <span>Usuario del lector</span>
              <input
                type="text"
                id="gpo-username"
                name="username"
                placeholder="admin"
                autocomplete="username"
              />
            </label>
            <label class="form-field">
              <span>Contraseña</span>
              <input
                type="password"
                id="gpo-password"
                name="password"
                placeholder="••••••••"
                autocomplete="current-password"
              />
            </label>
            <div class="form-actions">
              <button type="submit" class="cta cta--ghost">Guardar credenciales</button>
              <p class="muted">El lector responde 401 si no se envían credenciales válidas. Dejar usuario y contraseña vacíos borra las credenciales.</p>
            </div>
          </form>
        </article>

        <article class="panel">
          <header class="panel__header">
            <div>
              <p class="eyebrow">Escenarios rápidos</p>
              <h2>Simular decisiones</h2>
              <p class="muted">Lanza los pulsos configurados para accesos permitidos o denegados.</p>
            </div>
            <div class="panel__actions">
              <button type="button" id="gpo-scenario-granted" class="cta cta--primary">Acceso permitido</button>
              <button type="button" id="gpo-scenario-denied" class="cta cta--danger">Acceso denegado</button>
            </div>
          </header>
          <p class="muted">Los tiempos siguen la configuración actual (GPO4 5s, GPO5 10s, GPO6 5s).</p>
        </article>

        <article class="panel">
          <header class="panel__header">
            <div>
              <p class="eyebrow">Control manual</p>
              <h2>Encender, apagar o pulsar una línea</h2>
              <p class="muted">Envía una orden directa a una línea concreta para validar la instalación.</p>
            </div>
          </header>
          <form id="gpo-line-form" class="form-grid">
            <label class="form-field">
              <span>Línea</span>
              <select id="gpo-line" required>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
              </select>
            </label>
            <label class="form-field">
              <span>Acción</span>
              <select id="gpo-action" required>
                <option value="pulse">Pulso</option>
                <option value="on">Encender</option>
                <option value="off">Apagar</option>
              </select>
            </label>
            <label class="form-field">
              <span>Duración del pulso (ms)</span>
              <input type="number" id="gpo-duration" min="1" max="60000" value="1000" />
            </label>
            <div class="form-actions">
              <button type="submit" class="cta cta--primary">Enviar orden</button>
              <p class="muted">El tiempo solo aplica a la acción de pulso.</p>
            </div>
          </form>
        </article>

        <article class="panel panel--full">
          <header class="panel__header">
            <div>
              <p class="eyebrow">Respuestas de la API</p>
              <h2>Última respuesta recibida</h2>
              <p class="muted">
                Consulta el payload devuelto por el backend y por el lector tras cada petición de prueba.
              </p>
            </div>
          </header>
          <pre id="gpo-api-response" class="muted" aria-live="polite">Sin peticiones todavía.</pre>
        </article>
      </section>
    </main>
    <script src="elecnor-auth.js" data-shared-script></script>
    <script src="elecnor-ui.js" data-shared-script></script>
    <script src="elecnor-router.js" data-shared-script></script>
    <script data-shared-script>window.__RFID_BASE_PATH__ = "__BASE_PATH__";</script>
    <script src="elecnor-gpo.js" data-page-script="gpo"></script>
  </body>
</html>
