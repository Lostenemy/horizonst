<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>EMUASA · Lecturas</title>
    <base href="__BASE_PATH__/" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="__BASE_PATH__/style.css" />
  </head>
  <body class="elecnor-shell">
    <header class="topbar">
      <div class="brand">
        <div class="brand__mark" aria-hidden="true">emuasa</div>
        <div class="brand__text">
          <strong>Portal de accesos</strong>
          <span>Simulador RFID</span>
        </div>
      </div>
      <div class="topbar__cluster">
        <nav class="topbar__nav" aria-label="Navegación principal">
          <a class="nav-link" href="__BASE_PATH__/elecnor-tarjetas.html" data-router data-nav-view="tarjetas"
            >Tarjetas</a
          >
          <a
            class="nav-link nav-link--active"
            href="__BASE_PATH__/elecnor-lecturas.html"
            aria-current="page"
            data-requires-admin
            hidden
            aria-hidden="true"
            tabindex="-1"
            inert
            data-router
            data-nav-view="lecturas"
            >Lecturas</a
          >
          <a class="nav-link" href="__BASE_PATH__/elecnor-accesos.html" data-router data-nav-view="accesos"
            >Accesos</a
          >
          <a class="nav-link" href="__BASE_PATH__/elecnor-seguimiento.html" data-router data-nav-view="seguimiento"
            >Seguimiento</a
          >
          <a class="nav-link" href="__BASE_PATH__/elecnor-usuarios.html" data-router data-nav-view="usuarios"
            >Trabajadores</a
          >
          <a
            class="nav-link"
            href="__BASE_PATH__/elecnor-cuentas.html"
            data-requires-admin
            hidden
            aria-hidden="true"
            tabindex="-1"
            inert
            data-router
            data-nav-view="cuentas"
            >Cuentas</a
          >
          <a
            class="nav-link"
            href="__BASE_PATH__/elecnor-gpo.html"
            data-requires-admin
            hidden
            aria-hidden="true"
            tabindex="-1"
            inert
            data-router
            data-nav-view="gpo"
            >GPIO</a
          >
        </nav>
        <button type="button" class="cta cta--ghost topbar__logout" data-logout>Desconectar</button>
      </div>
    </header>

    <main id="main-view" class="page" data-view="lecturas">
      <section class="hero hero--compact">
        <div>
          <nav class="breadcrumb" aria-label="Ruta de navegación">
            <a href="__BASE_PATH__/elecnor-tarjetas.html" data-router>Portal de accesos</a>
            <span aria-hidden="true">›</span>
            <a href="__BASE_PATH__/elecnor-lecturas.html" data-router>Simulador RFID</a>
            <span aria-hidden="true">›</span>
            <span aria-current="page">Lecturas</span>
          </nav>
          <h1 class="page-title">Simular lecturas RFID</h1>
          <p class="lead lead--subhead">
            Reproduce el flujo completo (directorio MAC ↔ DNI, validación externa y publicación MQTT) con datos reales antes de desplegar en campo.
          </p>
          <div class="pill-row">
            <span class="pill pill--info">MQTT + API externa</span>
            <span class="pill pill--neutral">Histórico consultable</span>
            <span class="pill pill--accent">Usa el ID y MAC reales</span>
          </div>
        </div>
      </section>

      <section class="panel-grid panel-grid--single">
        <article class="panel panel--simulator">
          <header class="panel__header panel__header--stacked">
            <div>
              <p class="eyebrow">Lecturas</p>
              <h2>Simular lectura</h2>
              <p class="muted">Tarjeta y MAC son obligatorios; puedes complementar con fecha/hora y JSON opcional.</p>
            </div>
          </header>
          <form id="simulate-form" class="form-stack" novalidate>
            <div class="form-stack__row">
              <label class="form-field form-field--stack" for="simulate-card-id">
                <span class="form-label">ID de tarjeta<span class="required" aria-hidden="true">*</span></span>
                <input
                  type="text"
                  id="simulate-card-id"
                  required
                  autocomplete="off"
                  aria-required="true"
                  aria-describedby="card-id-hint card-id-error"
                  spellcheck="false"
                />
                <small class="field-hint" id="card-id-hint">Identificador exacto de la tarjeta o tag RFID.</small>
                <p class="field-error" id="card-id-error" role="alert" hidden></p>
              </label>
              <label class="form-field form-field--stack" for="simulate-mac">
                <span class="form-label">MAC del lector<span class="required" aria-hidden="true">*</span></span>
                <input
                  type="text"
                  id="simulate-mac"
                  required
                  autocomplete="off"
                  aria-required="true"
                  aria-describedby="mac-hint mac-error"
                  spellcheck="false"
                  inputmode="text"
                  placeholder="AA:BB:CC:DD:EE:FF"
                />
                <small class="field-hint" id="mac-hint">Formato esperado: AA:BB:CC:DD:EE:FF</small>
                <p class="field-error" id="mac-error" role="alert" hidden></p>
              </label>
            </div>

            <label class="form-field form-field--stack" for="simulate-timestamp">
              <span class="form-label">Fecha y hora (opcional)</span>
              <div class="datetime-group">
                <input
                  type="datetime-local"
                  id="simulate-timestamp"
                  aria-describedby="timestamp-hint timestamp-error"
                />
                <button type="button" class="cta cta--ghost cta--inline" id="use-current-timestamp">Usar ahora</button>
              </div>
              <small class="field-hint" id="timestamp-hint">Si se deja vacío, se usará la fecha/hora actual.</small>
              <p class="field-error" id="timestamp-error" role="alert" hidden></p>
            </label>

            <label class="form-field form-field--stack form-field--wide" for="simulate-additional">
              <span class="form-label">Datos adicionales (JSON)</span>
              <textarea
                id="simulate-additional"
                class="textarea textarea--mono"
                aria-describedby="additional-hint additional-error"
                placeholder="Pegue aquí un objeto JSON válido"
              ></textarea>
              <small class="field-hint" id="additional-hint">Opcional. Ejemplo: {"departamento":"I+D"}</small>
              <p class="field-error" id="additional-error" role="alert" hidden></p>
            </label>

            <div class="form-actions form-actions--stack">
              <div class="form-actions__primary">
                <button type="submit" class="cta cta--primary" id="simulate-submit">Enviar lectura</button>
                <p id="simulate-error" class="form-global-error" role="alert" hidden></p>
              </div>
              <div class="form-actions__notes">
                <p class="muted">El resultado incluye la decisión y las publicaciones MQTT realizadas.</p>
                <p class="muted small">Revisa formato antes de enviar para evitar reintentos.</p>
              </div>
            </div>
          </form>

          <section
            id="simulate-result"
            class="result-panel"
            aria-live="polite"
            aria-atomic="true"
            aria-label="Resultado de la simulación"
          >
            <div class="result-panel__header">
              <div>
                <p class="eyebrow">Resultado de la simulación</p>
                <h3 id="simulate-result-title">Aún no hay resultado</h3>
                <p class="muted" id="simulate-result-subtitle">Envía una lectura para ver la respuesta.</p>
              </div>
              <span class="status-chip status-chip--idle" id="simulate-result-state">Pendiente</span>
            </div>
            <div class="result-panel__body" id="simulate-result-body">
              <p class="muted">Incluiremos aquí la decisión y las publicaciones MQTT realizadas.</p>
            </div>
          </section>
        </article>
      </section>
    </main>
    <script src="elecnor-auth.js" data-shared-script></script>
    <script src="elecnor-ui.js" data-shared-script></script>
    <script src="elecnor-router.js" data-shared-script></script>
    <script data-shared-script>window.__RFID_BASE_PATH__ = "__BASE_PATH__";</script>
    <script src="elecnor-data.js" data-shared-script></script>
    <script src="elecnor-lecturas.js" data-page-script="lecturas"></script>
  </body>
</html>
